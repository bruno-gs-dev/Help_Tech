<!-- Session check removed (handled by JS) -->
<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Perfil</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Verificar se o usuário está logado
    const user = localStorage.getItem('user');
    if (!user) {
      window.location.href = '../../login/index.html';
    }
  </script>
</head>

<body class="bg-gradient-to-br from-blue-100 to-indigo-200 min-h-screen flex items-center justify-center">

  <!-- Sistema de Notificações Customizado -->
  <div id="notification-container" class="fixed top-5 right-5 z-50 space-y-3"></div>

  <style>
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }

      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    .notification {
      animation: slideIn 0.3s ease-out;
    }

    .notification.hiding {
      animation: slideOut 0.3s ease-in;
    }
  </style>

  <div class="bg-white shadow-2xl rounded-3xl w-[90%] max-w-6xl p-0 overflow-hidden m-6">
    <!-- Cabeçalho -->
    <div
      class="bg-gradient-to-r from-blue-600 to-indigo-700 p-8 text-white flex items-center justify-between rounded-t-3xl">
      <div class="flex items-center gap-4">
        <a href="../index.html" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg no-underline">◀ Voltar</a>
        <h1 class="text-3xl font-bold">Meu Perfil</h1>
      </div>
      <button class="bg-white text-blue-700 px-5 py-2 rounded-xl hover:bg-gray-100 transition font-medium">Sair</button>
      <script>
        // Adicione aqui a funcionalidade do botão Sair, se necessário
        window.onload = function () {
          document.querySelector('button').addEventListener('click', function () {
            // Redireciona para a página de logout ou encerra a sessão
            localStorage.removeItem('user');
            window.location.href = '../../index.html'; // Ajuste o caminho conforme necessário
          });
        };
      </script>
    </div>

    <!-- Corpo -->
    <div class="p-10 flex flex-col lg:flex-row gap-10">
      <!-- Coluna esquerda: Foto e informações -->
      <div class="flex flex-col items-center w-full lg:w-1/3 bg-gray-50 rounded-2xl p-6 shadow-inner">
        <div class="relative">
          <img id="profile-image" src="" alt="Foto do perfil" class="w-44 h-44 rounded-full border-4 border-blue-500 shadow-md object-cover hidden">
          <div id="profile-initial"
            class="w-44 h-44 rounded-full border-4 border-blue-500 shadow-md bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center">
            <span class="text-white text-6xl font-bold uppercase">?</span>
          </div>
        </div>
        <h2 class="mt-4 text-xl font-semibold text-gray-800" id="display-name">Nome do Usuário</h2>
        <p class="text-gray-500" id="display-email">email@example.com</p>

        <div class="mt-6 w-full space-y-3">
          <p class="text-gray-600"><span class="font-semibold">Telefone:</span> <span id="display-phone">-</span></p>
          <p class="text-gray-600"><span class="font-semibold">Nascimento:</span> <span id="display-birthdate">-</span>
          </p>
        </div>
      </div>

      <!-- Coluna direita: Formulário -->
      <div class="flex-1 bg-gray-50 rounded-2xl p-8 shadow-inner space-y-5">
        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Editar informações</h3>

        <div>
          <label class="block text-sm font-semibold text-gray-700">Nome Completo</label>
          <input id="name" type="text" value=""
            class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700">E-mail</label>
          <input id="email" type="email" value=""
            class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
        </div>

        <div class="flex flex-col sm:flex-row gap-5">
          <div class="flex-1">
            <label class="block text-sm font-semibold text-gray-700">Telefone</label>
            <input id="phone" type="text" value=""
              class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
          </div>
          <div class="flex-1">
            <label class="block text-sm font-semibold text-gray-700">Data de Nascimento</label>
            <input id="birthdate" type="text" placeholder="DD/MM/YYYY" value=""
              class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
          </div>
        </div>

        <div class="flex flex-col sm:flex-row items-center justify-between mt-8 gap-4">
          <button id="save-btn"
            class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl transition font-semibold w-full sm:w-auto">
            Salvar Alterações
          </button>

          <button id="delete-btn"
            class="bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-xl transition font-semibold w-full sm:w-auto">
            Excluir Conta
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase client (UMD) + shared config to allow client-side profile fetch/upsert -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="../../shared/supabase-config.js"></script>
  <script>
    if (window.SUPABASE_CONFIG && typeof supabase !== 'undefined') {
      try {
        window.SUPABASE_CLIENT = supabase.createClient(window.SUPABASE_CONFIG.url, window.SUPABASE_CONFIG.anonKey);
        console.log('[supabase-config] SUPABASE_CLIENT created (meu_perfil)');
      } catch (e) {
        console.warn('[supabase-config] failed to create SUPABASE_CLIENT on meu_perfil', e);
      }
    }

  </script>

  <script>
    // Ver o ID da sessão no console
    // console.log('ID da sessão:', <?php echo json_encode($_SESSION['user_id']); ?>);

    // API Base URL - Detecta automaticamente se está em produção ou desenvolvimento
    const API_BASE_URL = window.location.hostname === 'localhost'
      ? 'http://localhost:3000/api'
      : '/api';
    // Current profile id resolved from local store or server
    let CURRENT_PROFILE_ID = null;

    // Função para mostrar notificações customizadas
    function showNotification(message, type = 'success') {
      const container = document.getElementById('notification-container');

      // Criar elemento de notificação
      const notification = document.createElement('div');
      notification.className = `notification flex items-center gap-3 px-6 py-4 rounded-xl shadow-2xl max-w-md ${type === 'success'
        ? 'bg-gradient-to-r from-green-500 to-emerald-600'
        : 'bg-gradient-to-r from-red-500 to-rose-600'
        } text-white`;

      // Ícone
      const icon = type === 'success'
        ? `<svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
           </svg>`
        : `<svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
           </svg>`;

      notification.innerHTML = `
        ${icon}
        <span class="flex-1 font-medium">${message}</span>
        <button onclick="this.parentElement.remove()" class="hover:bg-white/20 rounded-lg p-1 transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      `;

      container.appendChild(notification);

      // Remover automaticamente após 4 segundos
      setTimeout(() => {
        notification.classList.add('hiding');
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    // Carregar informações do usuário ao abrir a página
    document.addEventListener('DOMContentLoaded', () => {
      carregarInformacoesUsuario();
    });

    // Função para carregar informações do banco de dados
    async function carregarInformacoesUsuario() {
      // Read logged user from localStorage
      let store = null;
      try {
        store = JSON.parse(localStorage.getItem('user')) || JSON.parse(localStorage.getItem('supabase.session')) || null;
      } catch (e) { store = null; }
      console.log('carregarInformacoesUsuario - local store:', store);

      // If we have a profile cached locally, populate the UI immediately as a fallback
      let appliedCachedProfile = false;
      if (store && store.profile) {
        try {
          const cached = store.profile;
          const metadata = cached.metadata || {};
          const cachedUsuario = {
            id: cached.id,
            name: cached.full_name || cached.username || (store.user && store.user.email) || '',
            email: metadata.email || (store.user && store.user.email) || '',
            phone: metadata.phone || metadata.phone_number || '',
            birthdate: metadata.birthdate || null,
            image: cached.image || metadata.profile_pic || metadata.image || metadata.avatar || null
          };

          // Update display and form from cached profile
          if (cachedUsuario.name) document.getElementById('display-name').textContent = cachedUsuario.name;
          if (cachedUsuario.email) document.getElementById('display-email').textContent = cachedUsuario.email;
          if (cachedUsuario.phone) document.getElementById('display-phone').textContent = cachedUsuario.phone;
          if (cachedUsuario.birthdate) document.getElementById('display-birthdate').textContent = formatDate(cachedUsuario.birthdate);

          if (cachedUsuario.image) {
            const imgEl = document.getElementById('profile-image');
            imgEl.src = cachedUsuario.image;
            imgEl.classList.remove('hidden');
            document.getElementById('profile-initial').classList.add('hidden');
          } else {
            const emailInitial = cachedUsuario.email ? cachedUsuario.email.charAt(0).toUpperCase() : '?';
            document.querySelector('#profile-initial span').textContent = emailInitial;
          }

          // Fill form inputs
          document.getElementById('name').value = cachedUsuario.name || '';
          document.getElementById('email').value = cachedUsuario.email || '';
          document.getElementById('phone').value = cachedUsuario.phone || '';
          document.getElementById('birthdate').value = cachedUsuario.birthdate ? formatDate(cachedUsuario.birthdate) : '';

          // Set current profile id for update/delete actions
          CURRENT_PROFILE_ID = cached.id || (store && store.user && (store.user.id || store.user.uid)) || null;
          appliedCachedProfile = true;
        } catch (e) {
          console.warn('Error applying cached profile to UI', e);
        }
      }

      // If a Supabase client is available and we have an authenticated user, try client-side fetch first
      try {
        let storeForClient = null;
        try { storeForClient = JSON.parse(localStorage.getItem('user')) || null; } catch (e) { storeForClient = null; }
        const authUserId = storeForClient && storeForClient.user && (storeForClient.user.id || storeForClient.user.uid) ? (storeForClient.user.id || storeForClient.user.uid) : null;
        if (window.SUPABASE_CLIENT && authUserId) {
          try {
            const { data: p, error: pErr } = await window.SUPABASE_CLIENT.from('profiles').select('id,username,full_name,role,is_admin,metadata,image').eq('id', authUserId).maybeSingle();
            if (!pErr && p) {
              // Found profile via client — apply and return
              const usuario = {
                id: p.id,
                name: p.full_name || p.username || (storeForClient && storeForClient.user && storeForClient.user.email) || '',
                email: (p.metadata && p.metadata.email) || (storeForClient && storeForClient.user && storeForClient.user.email) || '',
                phone: (p.metadata && (p.metadata.phone || p.metadata.phone_number)) || '',
                birthdate: (p.metadata && p.metadata.birthdate) || null,
                image: p.image || (p.metadata && (p.metadata.profile_pic || p.metadata.image || p.metadata.avatar)) || null
              };

              CURRENT_PROFILE_ID = usuario.id || authUserId;
              // Apply UI updates (reuse code below)
              document.getElementById('display-name').textContent = usuario.name || document.getElementById('display-name').textContent;
              document.getElementById('display-email').textContent = usuario.email || document.getElementById('display-email').textContent;
              document.getElementById('display-phone').textContent = usuario.phone || document.getElementById('display-phone').textContent;
              if (usuario.birthdate) document.getElementById('display-birthdate').textContent = formatDate(usuario.birthdate);
              if (usuario.image) {
                const imgEl = document.getElementById('profile-image');
                imgEl.src = usuario.image;
                imgEl.classList.remove('hidden');
                document.getElementById('profile-initial').classList.add('hidden');
              }
              if (usuario.name) document.getElementById('name').value = usuario.name;
              if (usuario.email) document.getElementById('email').value = usuario.email;
              if (usuario.phone) document.getElementById('phone').value = usuario.phone;
              if (usuario.birthdate) document.getElementById('birthdate').value = formatDate(usuario.birthdate);
              return; // done — no need to call server endpoints
            }
          } catch (e) {
            console.warn('Client profile fetch failed, will fallback to server candidates', e);
          }
        }

      } catch (e) { console.warn('Error checking client for profile', e); }

      // Build a list of candidate identifiers to try against the profiles table
      const candidates = [];
      if (store) {
        // 1. Direct user ID from auth object (most reliable)
        if (store.user) {
            candidates.push(store.user.id || null);
            candidates.push(store.user.uid || null); // Legacy Firebase style
            candidates.push(store.user.email || null);
        }
        // 2. Session user ID (if structure is { session: { user: ... } })
        if (store.session && store.session.user) {
            candidates.push(store.session.user.id || null);
        }
        // 3. Profile ID (if cached)
        if (store.profile) {
            candidates.push(store.profile.id || null);
            candidates.push(store.profile.user_id || null);
            // Metadata fallbacks
            if (store.profile.metadata) {
                candidates.push(store.profile.metadata.user_id || null);
                candidates.push(store.profile.metadata.sub || null);
            }
        }
      }

      // Remove duplicates and nulls
      const uniqueCandidates = Array.from(new Set(candidates.filter(Boolean)));
      console.log('Attempting profile fetch with candidates:', uniqueCandidates);

      // Helper: try each candidate sequentially until one returns success
      async function tryFetchCandidates(list) {
        for (const candidate of list) {
          console.log('Trying candidate id ->', candidate);
          try {
            const resp = await fetch(`${API_BASE_URL}/capturar_informacoes`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ action: 'user-info', userId: candidate })
            });
            const json = await resp.json().catch(() => null);
            console.log('Response for', candidate, json);
            if (json && json.success && json.data) {
              return { source: candidate, usuario: json.data };
            }
            // if 404 or not found, continue to next candidate
          } catch (err) {
            console.warn('Fetch error for candidate', candidate, err);
          }
        }
        return null;
      }

      // Run attempts and apply result if found
      tryFetchCandidates(uniqueCandidates).then(result => {
        if (!result) {
          // If we already applied a cached profile, don't show the "not found" debug notification.
          if (appliedCachedProfile) {
            console.log('Profile displayed from cache; skipping debug lookup and notification');
            return;
          }

          console.warn('No profile found for any candidate');
          showNotification('Perfil não encontrado. Verificando possíveis correspondências...', 'error');

          // Call server-side debug endpoint to get more info
          fetch(`${API_BASE_URL}/debug_profile_lookup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ candidates: uniqueCandidates })
          })
            .then(r => r.json())
            .then(debugData => {
              console.log('debug_profile_lookup result:', debugData);
              if (debugData && debugData.success && Array.isArray(debugData.results)) {
                const messages = debugData.results.map(r => {
                  if (!r.matches || r.matches.length === 0) return `${r.candidate}: no match`;
                  return `${r.candidate}: matched by ${r.matches.map(m => m.method).join(', ')}`;
                });
                showNotification('Debug: ' + messages.join(' | '), 'error');
              }
            }).catch(e => console.warn('debug lookup failed', e));
          return;
        }

        console.log('Selected profile source:', result.source, result.usuario);
        const usuario = result.usuario;

        // Set resolved profile id for update/delete actions
        CURRENT_PROFILE_ID = result.source || (usuario && usuario.id) || CURRENT_PROFILE_ID;

        // Atualizar informações de exibição
        document.getElementById('display-name').textContent = usuario.name || document.getElementById('display-name').textContent;
        document.getElementById('display-email').textContent = usuario.email || document.getElementById('display-email').textContent;
        document.getElementById('display-phone').textContent = usuario.phone || document.getElementById('display-phone').textContent;
        if (usuario.birthdate) document.getElementById('display-birthdate').textContent = formatDate(usuario.birthdate);

        // Atualizar imagem
        if (usuario.image) {
          const imgEl = document.getElementById('profile-image');
          imgEl.src = usuario.image;
          imgEl.classList.remove('hidden');
          document.getElementById('profile-initial').classList.add('hidden');
        }

        // Atualizar formulário
        if (usuario.name) document.getElementById('name').value = usuario.name;
        if (usuario.email) document.getElementById('email').value = usuario.email;
        if (usuario.phone) document.getElementById('phone').value = usuario.phone;
        if (usuario.birthdate) document.getElementById('birthdate').value = formatDate(usuario.birthdate);
      }).catch(err => {
        console.error('Error running candidate fetches', err);
        showNotification('Erro ao conectar com o servidor.', 'error');
      });
    }

    // Converter data para DD/MM/YYYY
    function formatDate(isoDate) {
      if (!isoDate) return '-';
      const date = new Date(isoDate + 'T00:00:00');
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    // Converter de DD/MM/YYYY para YYYY-MM-DD
    function parseDateToISO(dateString) {
      const [day, month, year] = dateString.split('/');
      return `${year}-${month}-${day}`;
    }

    // Salvar alterações
    document.getElementById('save-btn').addEventListener('click', () => {
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const birthdate = document.getElementById('birthdate').value;

      // Validações básicas no frontend
      if (!name.trim()) {
        showNotification('Por favor, preencha o nome.', 'error');
        return;
      }
      if (!email.trim()) {
        showNotification('Por favor, preencha o e-mail.', 'error');
        return;
      }

      // Ensure we have a userId
      const userIdForUpdate = CURRENT_PROFILE_ID || (function () {
        try {
          const s = JSON.parse(localStorage.getItem('user')) || null;
          return (s && s.profile && s.profile.id) || (s && s.user && (s.user.id || s.user.uid)) || null;
        } catch (e) { return null; }
      })();

      if (!userIdForUpdate) {
        showNotification('Não foi possível determinar o usuário. Refaça o login.', 'error');
        return;
      }

      // First, try a client-side Supabase upsert if client is available and authenticated
      (async function tryClientUpsert() {
        try {
          if (window.SUPABASE_CLIENT && window.SUPABASE_CLIENT.auth) {
            // Ensure we have a logged user
            let store = null;
            try { store = JSON.parse(localStorage.getItem('user')) || null; } catch (e) { store = null; }
            const authUserId = store && store.user && (store.user.id || store.user.uid) ? (store.user.id || store.user.uid) : null;
            const targetId = userIdForUpdate || authUserId;
            if (targetId) {
              const payload = {
                id: targetId,
                full_name: name || null,
                metadata: {
                  ...(store && store.profile && store.profile.metadata ? store.profile.metadata : {}),
                  email: email || undefined,
                  phone: phone || undefined,
                  birthdate: birthdate && birthdate.includes('/') ? parseDateToISO(birthdate) : birthdate || undefined
                }
              };

              // Use upsert so it creates or updates the profile row for this authenticated user
              const { data: upData, error: upErr } = await window.SUPABASE_CLIENT.from('profiles').upsert(payload, { returning: 'representation' }).select().maybeSingle();
              if (!upErr && upData) {
                showNotification('Perfil atualizado com sucesso', 'success');
                // Update UI and localStorage
                document.getElementById('display-name').textContent = name;
                document.getElementById('display-email').textContent = email;
                document.getElementById('display-phone').textContent = phone;
                document.getElementById('display-birthdate').textContent = birthdate;
                try {
                  const s = JSON.parse(localStorage.getItem('user')) || {};
                  s.profile = Object.assign(s.profile || {}, upData || payload);
                  localStorage.setItem('user', JSON.stringify(s));
                  if (window.AUTH_UI && typeof AUTH_UI.syncProfile === 'function') {
                    AUTH_UI.syncProfile(s.profile);
                    try { window.dispatchEvent(new Event('profile-updated')); } catch (e) { }
                  }
                } catch (e) { console.warn('Error syncing local profile after client upsert', e); }
                // Also update header profile image if present
                try {
                  const headerImg = document.getElementById('header-profile-img');
                  const pageImg = document.getElementById('profile-image');
                  const newImgUrl = (upData && (upData.image || (upData.metadata && (upData.metadata.profile_pic || upData.metadata.image || upData.metadata.avatar)))) || (payload && (payload.image || (payload.metadata && (payload.metadata.profile_pic || payload.metadata.image || payload.metadata.avatar)))) || (pageImg && pageImg.src) || null;
                  if (headerImg && newImgUrl) headerImg.src = newImgUrl;
                } catch (e) { /* ignore */ }
                return;
              }
            }
          }
        } catch (e) {
          console.warn('Client upsert failed, falling back to server:', e);
        }

        // Fallback to server endpoint
        try {
          const resp = await fetch(`${API_BASE_URL}/alterar_informacoes`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'update-user', userId: userIdForUpdate, name, email, phone, birthdate })
          });
          const data = await resp.json().catch(() => ({ success: false, message: 'Invalid response' }));
          if (data && data.success) {
            showNotification(data.message || 'Perfil atualizado', 'success');
            document.getElementById('display-name').textContent = name;
            document.getElementById('display-email').textContent = email;
            document.getElementById('display-phone').textContent = phone;
            document.getElementById('display-birthdate').textContent = birthdate;
            try {
              const s = JSON.parse(localStorage.getItem('user')) || {};
              s.profile = s.profile || {};
              s.profile.id = s.profile.id || userIdForUpdate;
              s.profile.full_name = name;
              s.profile.metadata = s.profile.metadata || {};
              s.profile.metadata.email = email;
              s.profile.metadata.phone = phone;
              s.profile.metadata.birthdate = birthdate && birthdate.includes('/') ? parseDateToISO(birthdate) : birthdate;
              localStorage.setItem('user', JSON.stringify(s));
              if (window.AUTH_UI && typeof AUTH_UI.syncProfile === 'function') {
                AUTH_UI.syncProfile(s.profile);
                try { window.dispatchEvent(new Event('profile-updated')); } catch (e) { }
              }
            } catch (e) { console.warn('Error syncing local profile after server save', e); }
            // Update header image to match page profile image if available
            try {
              const headerImg = document.getElementById('header-profile-img');
              const pageImg = document.getElementById('profile-image');
              const pageSrc = pageImg && pageImg.src ? pageImg.src : null;
              if (headerImg && pageSrc) headerImg.src = pageSrc;
            } catch (e) { /* ignore */ }
          } else {
            showNotification(data.message || 'Falha ao salvar perfil', 'error');
          }
        } catch (err) {
          console.error('Erro:', err);
          showNotification('Erro ao tentar salvar as alterações. Tente novamente.', 'error');
        }
      })();
    });

    // Excluir conta com requisição ao PHP
    document.getElementById('delete-btn').addEventListener('click', function () {
      if (confirm('Tem certeza que deseja excluir sua conta? Esta ação não pode ser desfeita!')) {

        // Ensure we have a userId
        const userIdForDelete = CURRENT_PROFILE_ID || (function () {
          try {
            const s = JSON.parse(localStorage.getItem('user')) || null;
            return (s && s.profile && s.profile.id) || (s && s.user && (s.user.id || s.user.uid)) || null;
          } catch (e) { return null; }
        })();

        if (!userIdForDelete) {
          showNotification('Não foi possível determinar o usuário. Refaça o login.', 'error');
          return;
        }

        // Faz a requisição para a API
        fetch(`${API_BASE_URL}/alterar_informacoes`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ action: 'delete-account', userId: userIdForDelete })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              showNotification(data.message, 'success');
              // Redireciona para a página de login após 1 segundo
              setTimeout(() => window.location.href = '../../login/index.html', 1000);
            } else {
              showNotification(data.message, 'error');
            }
          })
          .catch(error => {
            console.error('Erro:', error);
            showNotification('Erro ao tentar excluir a conta. Tente novamente.', 'error');
          });
      }
    });
  </script>
</body>

</html>